#!/bin/bash

mydir="$(cd "$(dirname "$0")" && /usr/bin/env pwd)"
export PATH="$mydir":"$PATH"

address="ssh://nikos@hagrid:$(irma:port)/$(_irma:get_repo_address)"

if git remote | grep -E -e '^irma$'
then
  git remote set-url irma "$address"
else
  git remote add irma "$address"
fi

ssh-add -L |
  ide:ssh_hagrid bash -c \
    "$(ruby -r shellwords -e 'ARGV.map(&Shellwords.method(:escape)).each(&method(:print))' \
    'docker run --rm -i --volumes-from irma_home intelli bash -c "mkdir -pv ~/.ssh && tee -a ~/.ssh/authorized_keys"' )"
